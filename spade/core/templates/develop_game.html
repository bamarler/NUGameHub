{% extends 'base.html' %}

{% load static %}

{% block title %}{{ game.name }} - Develop{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/develop_styles.css' %}">
<div class="develop-background" style="background-image: url('{% static 'images/develop-background.png' %}');">
    <div class="overlay"></div>
    <div class="page">
        <div class="develop-container">
            <div class="dev-panel">
                <div class="header-with-back">
                    <button class="back-button" onclick="window.location.href='{% url 'develop' %}'">&#8592;</button>
                    <h2>{{ game.name }} - {{ game.get_status_display }}</h2>
                </div>
                <!-- Game Update Form -->
                <form method="post" action="{% url 'develop_game' game.slug %}" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="id_name">Name:</label>
                        {{ form.name }}
                    </div>
                    <div class="form-group">
                        <label for="id_description">Description:</label>
                        {{ form.description }}
                    </div>
                    <div class="form-group">
                        <label for="id_instructions">Instructions:</label>
                        {{ form.instructions }}
                    </div>

                    <!-- Cover Image Upload/Change -->
                    <div class="cover-image-section">
                        <label>Cover Image:</label>
                        {% if game.cover_image %}
                            <div class="cover-image">
                                <img src="{{ game.cover_image.url }}" alt="{{ game.name }} Cover Image">
                                <label for="id_cover_image" class="upload-button">Change Image</label>
                            </div>
                        {% else %}
                            <label for="id_cover_image" class="upload-button">Upload Image</label>
                        {% endif %}
                        <div class="cover-image-form">
                            {{ form.cover_image }}
                        </div>
                    </div>

                    <button type="submit" class="update-button">Update Details</button>
                </form>
            </div>
            <div class="game-view">
                <!-- Replace this section with Ace Editor -->
                <div id="editor"></div>
            </div>
        </div>        
    </div>
</div>

<!-- Include the latest version of Ace Editor -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.9/ace.js" integrity="sha512-f4Yo8w1+9HPuxfhS6l3HIfQX4L2yISbwxWXtReJ6+8UsvUv/1BItUyRXStJHPMgbR3iLhoFHbsvnpTSBDrG1qg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<!-- Initialize Ace Editor -->
<script>
    var editor = ace.edit("editor");
    editor.setTheme("ace/theme/monokai");
    editor.session.setMode("ace/mode/javascript");

    editor.setOptions({
        fontSize: "14px",
        showLineNumbers: true,
        showGutter: true,
        vScrollBarAlwaysVisible: true,
        enableBasicAutocompletion: true,
        enableSnippets: true,
        enableLiveAutocompletion: true,
    });

    // Load the game JavaScript file into the editor
    fetch("{{ game.js_file.url }}")
        .then(response => response.text())
        .then(code => editor.setValue(code, 1)); // 1 indicates move cursor to the end
</script>
{% endblock %}
